{% extends "base.html" %}

{% block title %}编辑设备{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-gray-800">编辑设备信息</h1>
        <a href="{{ url_for('device.index') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> 返回设备列表
        </a>
    </div>

    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">设备信息</h6>
        </div>
        <div class="card-body">
            <form method="post" action="{{ url_for('device.edit', device_id=device.id) }}">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="name" class="form-label">设备名称 <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="name" name="name" value="{{ device.name }}" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="device_code" class="form-label">设备编码 <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="device_code" name="device_code" value="{{ device.device_code }}" required>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="type_id" class="form-label">设备类型</label>
                        <select class="form-control" id="type_id" name="type_id">
                            <option value="">-- 选择设备类型 --</option>
                            {% for type in device_types %}
                            <option value="{{ type.id }}" {% if device.type_id == type.id %}selected{% endif %}>
                                {{ type.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="status" class="form-label">设备状态</label>
                        <select class="form-control" id="status" name="status">
                            <option value="正常" {% if device.status == '正常' %}selected{% endif %}>正常</option>
                            <option value="维修中" {% if device.status == '维修中' %}selected{% endif %}>维修中</option>
                            <option value="闲置" {% if device.status == '闲置' %}selected{% endif %}>闲置</option>
                            <option value="报废" {% if device.status == '报废' %}selected{% endif %}>报废</option>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="location" class="form-label">设备位置</label>
                        <input type="text" class="form-control" id="location" name="location" value="{{ device.location or '' }}">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="ip_address" class="form-label">IP地址</label>
                        <input type="text" class="form-control" id="ip_address" name="ip_address" 
                               value="{{ device.ip_address or '' }}"
                               pattern="^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$"
                               placeholder="如：192.168.1.1">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="mac_address" class="form-label">MAC地址</label>
                        <input type="text" class="form-control" id="mac_address" name="mac_address" 
                               value="{{ device.mac_address or '' }}"
                               pattern="^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$"
                               placeholder="如：00:1A:2B:3C:4D:5E">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="manufacturer" class="form-label">制造商</label>
                        <input type="text" class="form-control" id="manufacturer" name="manufacturer" value="{{ device.manufacturer or '' }}">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="username" class="form-label">设备账号</label>
                        <input type="text" class="form-control" id="username" name="username" 
                               value="{{ device.username or '' }}"
                               placeholder="设备登录账号">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="password" class="form-label">设备密码</label>
                        <input type="password" class="form-control" id="password" name="password"
                               placeholder="设备登录密码">
                        <small class="form-text text-muted">留空表示不修改密码</small>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="model" class="form-label">设备型号</label>
                        <input type="text" class="form-control" id="model" name="model" value="{{ device.model or '' }}">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="serial_number" class="form-label">序列号</label>
                        <input type="text" class="form-control" id="serial_number" name="serial_number" value="{{ device.serial_number or '' }}">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="purchase_date" class="form-label">购买日期</label>
                        <input type="date" class="form-control" id="purchase_date" name="purchase_date" 
                               value="{{ device.purchase_date.strftime('%Y-%m-%d') if device.purchase_date else '' }}">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="warranty_period" class="form-label">保修期(月)</label>
                        <input type="number" class="form-control" id="warranty_period" name="warranty_period" 
                               value="{{ device.warranty_period or '' }}" min="0">
                    </div>
                </div>

                <div class="mb-3">
                    <label for="notes" class="form-label">备注</label>
                    <textarea class="form-control" id="notes" name="notes" rows="3">{{ device.notes or '' }}</textarea>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card bg-light">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>创建时间:</strong> {{ device.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>最后更新:</strong> {{ device.updated_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <a href="{{ url_for('device.view', device_id=device.id) }}" class="btn btn-info">
                        <i class="fas fa-eye"></i> 查看详情
                    </a>
                    <button type="submit" class="btn btn-primary">保存更改</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %} 