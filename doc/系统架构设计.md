# 校园安全管理系统架构设计

## 1. 系统架构概述

校园安全管理系统采用分层架构设计，包括前端展示层、应用服务层、数据访问层和基础设施层。系统通过模块化设计提高代码复用性和可维护性，同时便于功能扩展。

## 2. 系统架构图

```
+---------------------------+
|       前端展示层           |
| +---------------------+   |
| |     Web界面         |   |
| +---------------------+   |
+---------------------------+
            ↑↓
+---------------------------+
|       应用服务层           |
| +---------------------+   |
| |    业务逻辑模块      |   |
| +---------------------+   |
| |    设备接口模块      |   |
| +---------------------+   |
+---------------------------+
            ↑↓
+---------------------------+
|       数据访问层           |
| +---------------------+   |
| |   数据库访问模块    |   |
| +---------------------+   |
| |   缓存访问模块      |   |
| +---------------------+   |
+---------------------------+
            ↑↓
+---------------------------+
|       基础设施层           |
| +---------------------+   |
| |   数据库            |   |
| +---------------------+   |
| |   eNSP设备接口      |   |
| +---------------------+   |
| |   缓存服务          |   |
| +---------------------+   |
+---------------------------+
```

## 3. 技术架构

### 3.1 前端技术架构

- Web框架：Flask（轻量级框架，适合中小型应用）
- 前端UI：Bootstrap（响应式设计，快速开发）
- 数据可视化：ECharts（丰富的图表类型，适合性能监控展示）
- 前端交互：jQuery + AJAX（简化DOM操作和异步请求）

### 3.2 后端技术架构

- 开发语言：Python 3.8+
- Web框架：Flask 2.0+
- 数据库ORM：SQLAlchemy
- 缓存：Redis
- 身份认证：Flask-Login + JWT
- 设备通信：Paramiko (SSH), PySNMP, Netmiko

### 3.3 数据存储架构

- 关系型数据库：MySQL 8.0
- 缓存数据库：Redis
- 文件存储：本地文件系统（配置文件、日志等）

## 4. 模块设计

### 4.1 核心模块

#### 4.1.1 用户认证模块
- 功能：实现用户登录、登出、权限管理等功能
- 主要组件：
  - 用户认证服务
  - 权限管理服务
  - 会话管理服务

#### 4.1.2 设备管理模块
- 功能：管理和监控网络设备
- 主要组件：
  - 设备信息管理服务
  - 设备状态监控服务
  - 设备配置管理服务

#### 4.1.3 故障管理模块
- 功能：监测、记录和处理设备故障
- 主要组件：
  - 故障检测服务
  - 故障记录服务
  - 告警通知服务

#### 4.1.4 维护管理模块
- 功能：管理设备维护任务
- 主要组件：
  - 任务管理服务
  - 日历服务
  - 统计分析服务

#### 4.1.5 性能管理模块
- 功能：监控和分析设备性能
- 主要组件：
  - 性能数据采集服务
  - 阈值监控服务
  - 报告生成服务

#### 4.1.6 系统管理模块
- 功能：管理系统配置和用户
- 主要组件：
  - 用户管理服务
  - 系统配置服务
  - 日志管理服务

### 4.2 公共模块

#### 4.2.1 数据访问模块
- 功能：提供统一的数据访问接口
- 主要组件：
  - 数据库访问服务
  - 缓存访问服务
  - 数据转换服务

#### 4.2.2 设备通信模块
- 功能：与网络设备通信
- 主要组件：
  - SSH通信服务
  - SNMP通信服务
  - Telnet通信服务

#### 4.2.3 日志模块
- 功能：记录系统操作和异常
- 主要组件：
  - 操作日志服务
  - 错误日志服务
  - 性能日志服务

#### 4.2.4 工具模块
- 功能：提供通用工具函数
- 主要组件：
  - 数据验证工具
  - 加密解密工具
  - 时间处理工具

## 5. 数据库设计

### 5.1 ER图

```
+-------------+      +-------------+      +-------------+
|    用户     |------n|    设备     |------n|    故障     |
+-------------+      +-------------+      +-------------+
       |                    |                    |
       |                    |                    |
       n                    n                    n
+-------------+      +-------------+      +-------------+
|  维护任务   |------n|  性能记录   |------n|   系统日志  |
+-------------+      +-------------+      +-------------+
```

### 5.2 主要数据表

#### 5.2.1 用户表 (users)
- id: 主键
- username: 用户名
- password_hash: 加密后的密码
- email: 邮箱
- role_id: 角色ID
- is_active: 是否激活
- created_at: 创建时间
- updated_at: 更新时间

#### 5.2.2 角色表 (roles)
- id: 主键
- name: 角色名称
- permissions: 权限集合
- description: 角色描述

#### 5.2.3 设备表 (devices)
- id: 主键
- name: 设备名称
- ip_address: IP地址
- device_type: 设备类型（路由器、交换机等）
- location: 位置
- status: 状态
- created_at: 创建时间
- updated_at: 更新时间

#### 5.2.4 故障表 (faults)
- id: 主键
- device_id: 设备ID
- fault_type: 故障类型
- severity: 严重程度
- description: 故障描述
- status: 处理状态
- reported_by: 报告人
- created_at: 创建时间
- updated_at: 更新时间

#### 5.2.5 维护任务表 (maintenance_tasks)
- id: 主键
- title: 任务标题
- description: 任务描述
- device_id: 设备ID
- status: 任务状态
- priority: 优先级
- assigned_to: 负责人
- start_time: 开始时间
- end_time: 结束时间
- created_at: 创建时间
- updated_at: 更新时间

#### 5.2.6 性能记录表 (performance_records)
- id: 主键
- device_id: 设备ID
- cpu_usage: CPU使用率
- memory_usage: 内存使用率
- bandwidth_usage: 带宽使用率
- recorded_at: 记录时间

#### 5.2.7 阈值配置表 (thresholds)
- id: 主键
- device_id: 设备ID
- metric_name: 指标名称
- warning_threshold: 警告阈值
- critical_threshold: 严重阈值
- created_at: 创建时间
- updated_at: 更新时间

#### 5.2.8 系统日志表 (system_logs)
- id: 主键
- user_id: 用户ID
- action: 操作
- target: 操作对象
- details: 详细信息
- ip_address: IP地址
- created_at: 创建时间

## 6. 接口设计

### 6.1 内部接口

#### 6.1.1 数据库接口
- 提供增删改查等基本操作
- 支持事务管理
- 支持批量操作

#### 6.1.2 缓存接口
- 提供数据缓存功能
- 支持缓存过期策略
- 支持缓存更新策略

#### 6.1.3 设备通信接口
- 提供SSH/Telnet连接功能
- 提供SNMP查询功能
- 提供命令执行功能

### 6.2 外部接口

#### 6.2.1 Web接口（RESTful API）
- 用户认证接口：登录、登出、获取用户信息
- 设备管理接口：获取设备列表、设备详情、设备状态
- 故障管理接口：获取故障列表、上报故障、处理故障
- 维护管理接口：获取任务列表、创建任务、更新任务
- 性能管理接口：获取性能数据、设置阈值、生成报告
- 系统管理接口：用户管理、日志查询、系统配置

## 7. 安全设计

### 7.1 用户认证与授权
- 采用JWT进行身份认证
- 基于角色的访问控制（RBAC）
- 密码加密存储（bcrypt）
- 会话超时机制

### 7.2 数据安全
- 敏感数据加密存储
- 数据库访问控制
- 数据备份和恢复

### 7.3 通信安全
- HTTPS加密传输
- API访问控制
- 设备通信加密

### 7.4 日志审计
- 用户操作日志记录
- 安全事件日志记录
- 日志定期备份

## 8. 部署架构

### 8.1 开发环境
- 操作系统：Windows/Linux
- 开发工具：PyCharm/VSCode
- 版本控制：Git
- 虚拟环境：venv/virtualenv

### 8.2 测试环境
- 操作系统：Linux
- 服务器：单机部署
- 数据库：本地MySQL
- 网络环境：内网

### 8.3 生产环境
- 操作系统：Linux (Ubuntu/CentOS)
- Web服务器：Nginx + Gunicorn
- 数据库服务器：独立MySQL服务器
- 缓存服务器：独立Redis服务器
- 负载均衡：Nginx
- 监控：Prometheus + Grafana

## 9. 扩展性设计

### 9.1 水平扩展
- 应用服务器集群
- 数据库读写分离
- 缓存集群

### 9.2 功能扩展
- 插件化架构
- 模块化设计
- 配置化开发

### 9.3 接口扩展
- 标准化API设计
- 版本控制
- 文档自动生成 